// _mobile-responsive.scss — Mobile-specific layout and spacing
// ================================================
// Purpose: Handle mobile-specific layout adjustments
// Typography scaling now handled in _base.scss


// Mobile-Optimized Content Padding
// ================================================
// Main wrapper padding (applies to all pages) - with higher specificity
.wrapper {
  @include media-query($on-mobile) {
    padding: 30px 1.5rem !important; // Force override and match iA.net exactly
  }
  
  // Specific handling for post pages
  &.post {
    @include media-query($on-mobile) {
      padding: 30px 1.5rem !important; // Ensure posts also get correct padding
    }
  }
  
  // Ensure main content area has proper constraints
  main {
    max-width: $narrow-size;
    margin: 0 auto;
    
    @include media-query($on-mobile) {
      max-width: 100%;
    }
  }
  
  // Desktop: optimal measure based on golden ratio
  @media (min-width: 768px) {
    main {
      max-width: calc(var(--base-font-desktop) * 1.618 * 30); // φ-based optimal measure
    }
  }
}

// 5. Navigation Mobile Enhancements
// ================================================
@include media-query($on-mobile) {
  .navbar {
    // Fixed navigation (not sticky) to avoid spacing issues
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    background: rgba($white, 0.98);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }
  
  // Content wrapper with proper spacing
  .wrapper {
    padding: 70px 1.5rem 30px 1.5rem !important; // Single padding declaration
    
    &.post {
      padding: 70px 1.5rem 30px 1.5rem !important; // Same for posts
    }
  }
  
  // Home and archive pages need padding too
  body.home,
  body.archive {
    padding: 70px 1.5rem 30px 1.5rem;
  }
  
  // Ensure pages with wrapper but not posts also get padding
  // Generic wrapper padding for ALL pages
  body:not(.home) .wrapper {
    padding: 70px 1.5rem 30px 1.5rem !important;
  }
  
  // Or if colophon has a specific body class
  body.page .wrapper {
    padding: 70px 1.5rem 30px 1.5rem !important;
  }
}

// 6. Typography Refinements for Mobile
// ================================================
@include media-query($on-mobile) {
  // Paragraphs with optimal mobile spacing
  p {
    margin-bottom: $space-md;
    text-align: left; // Force left-align on mobile
    hyphens: auto; // Enable hyphenation for narrow screens
    -webkit-hyphens: auto;
  }
  
  // Lists with better mobile indentation
  ul, ol {
    margin-left: $space-lg;
    padding-left: 0;
  }
  
  // Blockquotes optimized for mobile
  blockquote {
    margin: $space-md 0;
    padding-left: $space-md;
    border-left-width: 3px;
    
    // Fix for excessive vertical space
    p {
      margin: 0;
      padding: 0;
    }
  }
}

// 7. Image Handling with Classical Proportions
// ================================================
// Based on Aldus Manutius and golden ratio principles
.page-content {
  // Standard images - harmonious with text measure
  > figure,
  > p > img,
  > img {
    display: block;
    max-width: 85%; // Classical proportion: slightly narrower than full text width
    width: auto;
    height: auto;
    margin: 2rem auto; // Generous breathing room
    
    // Ensure proper aspect ratio preservation
    object-fit: contain;
    
    @include media-query($on-mobile) {
      max-width: 90%; // Slightly wider on mobile but still proportional
      margin: 1.5rem auto;
    }
  }
  
  // Large images can use golden ratio width
  .image-large,
  .full-width {
    max-width: 100%;
    margin: 3rem auto; // More dramatic spacing for emphasis
    
    @include media-query($on-mobile) {
      margin: 2rem -1.5rem; // Full bleed on mobile only when specifically requested
      max-width: calc(100% + 3rem);
      width: calc(100% + 3rem);
    }
  }
  
  // Small images use classical book proportions
  .image-small {
    max-width: 61.8%; // Golden ratio proportion
    margin: 1.5rem auto;
    
    @include media-query($on-mobile) {
      max-width: 70%;
    }
  }
  
  // Caption styles moved to _base.scss
}

// 8. Code Blocks on Mobile
// ================================================
@include media-query($on-mobile) {
  // Inline code
  code {
    font-size: 0.9em;
    padding: 0.1em 0.3em;
  }
  
  // Code blocks
  pre,
  .highlight {
    font-size: 0.85em;
    line-height: 1.5;
    padding: 1em;
    margin-left: -1.5rem; // Match iA.net padding
    margin-right: -1.5rem; // Match iA.net padding
    border-radius: 0;
    
    // Add subtle scroll hint
    &::-webkit-scrollbar {
      height: 6px;
    }
    
    &::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
    }
    
    &::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 3px;
    }
  }
}

// 9. Tables on Mobile
// ================================================
@include media-query($on-mobile) {
  table {
    font-size: 0.9em;
    
    th, td {
      padding: 0.4rem;
    }
  }
}

// 10. Footer Mobile Spacing
// ================================================
@include media-query($on-mobile) {
  .footer {
    margin-top: 3em;
    padding: 2em 1.5rem; // Match iA.net padding
    
    .footer_item {
      display: inline-block;
      margin: 0.2em 0.5em;
    }
  }
}

// 11. Author Section Mobile
// ================================================
@include media-query($on-mobile) {
  .author {
    margin-top: 2em;
    margin-bottom: 3em;
    
    .author-avatar {
      width: 60px;
      height: 60px;
      margin: 0 auto 1em;
    }
    
    .author-name {
      font-size: 1.4em;
      margin-bottom: 0.5em;
    }
    
    .author-bio {
      font-size: 0.95em;
      padding: 0 1em;
      max-width: 100%;
    }
  }
}

// 12. Post List Mobile
// ================================================
@include media-query($on-mobile) {
  .post-list {
    .post-item {
      padding: 1em 0;
      
      .post-item-date {
        font-size: 0.9em;
        min-width: 80px;
      }
      
      .post-item-title {
        font-size: 1em;
        line-height: 1.4;
      }
    }
  }
}

// 13. Utility Classes Mobile Support
// ================================================
@include media-query($on-mobile) {
  // Ensure all utility classes work on mobile
  .small-caps {
    font-size: 0.95em; // Slightly smaller on mobile
  }
  
  .poetic {
    margin: 1.2rem 0;
    padding: 0 0.5em;
    font-size: 0.95em;
  }
  
  .callout {
    margin: 1.5rem -0.75rem; // Half of iA.net padding
    padding: 1rem 1.5rem; // Match iA.net padding
    border-left-width: 3px;
    font-size: 0.9em;
  }
  
  .whisper {
    font-size: 0.8rem;
  }
}

// 14. Drop Caps for Article Openings
// ================================================
// Beautiful drop caps that work on all screen sizes
.drop-cap {
  &::first-letter {
    float: left;
    font-family: $serif-family;
    font-size: 3.2em;
    line-height: 0.8;
    margin: 0.1em 0.08em 0 0;
    font-weight: $bold-weight;
    color: $text-color; // Match text color instead of accent
    
    @include media-query($on-mobile) {
      font-size: 2.8em;
      margin: 0.15em 0.05em 0 0;
    }
  }
}

// Essay class for intentional drop caps on substantial pieces
.essay {
  .page-content > p:first-of-type:not(.no-drop-cap) {
    @extend .drop-cap;
  }
}

// Manual drop cap application - remove automatic behavior  
// Note: Drop caps now require intentional application via .essay class or .drop-cap class

// 15. Performance Optimizations
// ================================================
@include media-query($on-mobile) {
  // Reduce animation complexity on mobile
  * {
    animation-duration: 0.2s !important;
  }
  
  // Optimize touch targets
button {
  min-height: 44px;
  min-width: 44px;
}

// Only apply to navigation links, not inline text links
.menu-link,
.footer_item {
  min-height: 44px;
  display: inline-flex;
  align-items: center;
}
}

// 16. Dark Mode Mobile Adjustments
// ================================================
body[data-theme="dark"] {
  @include media-query($on-mobile) {
    .navbar {
      background: rgba($dark-black, 0.98);
    }
    
    .callout {
      background-color: rgba($dark-light, 0.5);
      border-left-color: $dark-smoke;
    }
    
    pre, .highlight {
      background: $dark-light;
    }
  }
}